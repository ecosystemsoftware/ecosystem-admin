<html><head><link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">

<link rel="import" href="eco-login-form.html">
<link rel="import" href="eco-view.html">
<link rel="import" href="eco-404.html">
<link rel="import" href="eco-behaviors.html">




</head><body><dom-module id="eco-admin-app">

    <template>

        <style include="custom-styles">
            :host {
                display: block;
            }
            
            app-header {
                color: #fff;
                background-color: var(--secondary-color);
            }
            
            app-header paper-icon-button {
                --paper-icon-button-ink-color: white;
            }
            
            app-drawer {
                --app-drawer-content-container: {
                    background-color: var(--sidebar-color);
                }
            }
            
            #sidebarLogoContainer {
                text-align: center;
            }
            
            #sidebarLogo {
                max-width: 100%;
                max-height: 120px;
                padding: 2em;
            }
            
            #mainLogo {
                max-height: 30px;
            }
            
            .drawer-list {
                margin: 0 20px;
            }
            
            .drawer-list a {
                display: block;
                padding: 0 16px;
                text-decoration: none;
                color: var(--primary-text-color);
                font-size: 1.3rem;
                line-height: 2.2rem;
            }
            
            .drawer-list a.iron-selected {
                color: var(--primary-text-color);
                font-weight: bold;
            }
        </style>

        
        <iron-ajax auto="" id="menuListRequest" method="GET" url="/menu" handle-as="json" last-response="{{ menusAvailable }}"></iron-ajax>

        
        <app-location route="{{route}}"></app-location>
        <app-route route="{{route}}" pattern="/admin/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>

        
        <iron-localstorage use-raw="" name="token" value="{{jwt}}"></iron-localstorage>

        
        <iron-ajax method="GET" id="configRequest" headers="[[ _getJWT(jwt) ]]" handle-as="json"></iron-ajax>

        
        <template is="dom-if" if="[[ !jwt]]">
            <eco-login-form jwt="{{ jwt }}"></eco-login-form>
        </template>

        
        <template is="dom-if" if="[[ jwt ]]">

            <app-drawer-layout fullbleed="" responsive-width="1000px">
                
                <app-drawer>

                    <div id="sidebarLogoContainer">
                        <img id="sidebarLogo" src="[[ logos.vertical ]]">
                        <h2>{{ adminPanelTitle }}</h2>
                    </div>

                    <iron-selector class="drawer-list" role="navigation">
                        <template is="dom-repeat" items="[[ bundlesInstalled ]]" as="bundle">
                            <h2>[[ _getBundleMenuTitle(bundle, menusAvailable) ]]</h2>
                            <template is="dom-repeat" items="[[ _getBundleMenuItems(bundle, menusAvailable) ]]" as="menuItem">
                                <a href="/admin/view/{{ menuItem.schema }}/{{ menuItem.table }}?view={{ menuItem.view }}">{{ menuItem.title }}</a>
                            </template>
                        </template>
                    </iron-selector>

                </app-drawer>

                
                <app-header-layout has-scrolling-region="">

                    <app-header fixed="" condenses="" effects="waterfall">
                        <app-toolbar>
                            <paper-icon-button icon="menu" drawer-toggle=""></paper-icon-button>
                            <div main-title="">
                                <img id="mainLogo" src="[[ logos.horizontal ]]">
                            </div>
                            <paper-button on-tap="_logout">Log Out</paper-button>
                            <paper-icon-button icon="arrow-back" on-tap="_goBack"></paper-icon-button>
                        </app-toolbar>
                    </app-header>

                    <iron-pages selected="[[ routeData.page ]]" attr-for-selected="name" fallback-selection="eco-404" role="main">

                        <eco-view name="view" jwt="[[ jwt ]]" route="[[ subroute ]]" config="[[ config ]]"></eco-view>
                        <div name="">
                            <h1>Welcome to EcoSystem</h1>
                            <h2>Use the menu on the left to get started</h2>
                        </div>
                        <eco-404 name="eco-404"></eco-404>

                    </iron-pages>

                </app-header-layout>

            </app-drawer-layout>

        </template>

    </template>

    <script>Polymer({is:"eco-admin-app",behaviors:[EcoBehaviors.ApiBehavior,EcoCustom.Properties],properties:{route:{type:Object},routeData:{type:Object},config:{type:Object,value:function(){return{}}}},listeners:{updateConfig:"_updateConfig","configRequest.response":"_configUpdated"},_goBack:function(){window.history.back()},_showPage404:function(){this.page="eco-404"},_logout:function(){var e=confirm("Are you sure you want to log out?");1==e&&this.set("jwt",null)},_updateConfig:function(e){this.$.configRequest.url=this.apiRoot+"/"+e.detail.table,this.$.configRequest.generateRequest()},_configUpdated:function(e){var t=e.detail.__data__.xhr.responseURL,o=t.lastIndexOf("/"),n="config."+t.substring(o+1,t.length);this.set(n,e.detail.__data__.response)},_getBundleMenuItems:function(e,t){return t[e]?t[e].items:[]},_getBundleMenuTitle:function(e,t){return t[e]?t[e].title:""}});</script>
</dom-module></body></html>